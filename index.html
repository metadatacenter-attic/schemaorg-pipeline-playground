<!doctype html>
<html>

<head>
  <meta charset="UTF8">
  <title>Schema.org Pipeline Playground</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link type="text/css" rel="stylesheet" href="assets/css/materialize.min.css"
      media="screen,projection">
  <link type="text/css" rel="stylesheet" href="assets/css/material-icons.css"
      media="screen,projection">
  <link type="text/css" rel="stylesheet" href="assets/css/stylesheet.css"
      media="screen,projection">
  <script type="text/javascript" src="assets/libs/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="assets/libs/materialize.min.js"></script>
  <script type="text/javascript" src="assets/libs/split.min.js"></script>
  <script type="text/javascript">
    $(document).ready(function () {
      $('#translation-panel').hide();
      $('#html-panel').hide();
      $('#reset').click(function() {
        $('#mapping-input').val("");
        $('#language-type').val("");
        $('#datasource-input').val("");
        $('#datasource-type').val("");
        $('#translation-output').val("");
        $('#schema-output').val("");
        $('#html-output').val("");
        splitPanels.setSizes([33.3,33.3,33.3]);
      });
      $('#run').click(function() {
        jQuery.support.cors = true;
        var payload_object = {
          mapping: {
            language: $('#language-type').val(),
            value: $('#mapping-input').val()
          },
          dataSource: {
            type: $('#datasource-type').val(),
            value: $('#datasource-input').val()
          }
        }
        var payload = JSON.stringify(payload_object)
        $.ajax(
          {
            type: "POST",
            url: "http://localhost:8080/pipeline/map2query",
            data: payload,
            contentType: "application/json; charset=utf-8",
            dataType: "text",
            success: function (data) {
              $('#translation-output').val(data);
            },
            error: function (msg, url, line) {
              alert('msg = ' + msg + ', url = ' + url + ', line = ' + line);
            }
          });
        $.ajax(
          {
            type: "POST",
            url: "http://localhost:8080/pipeline/data2schema",
            data: payload,
            contentType: "application/json; charset=utf-8",
            dataType: "text",
            success: function (data) {
              var pretty_data = JSON.stringify(JSON.parse(data), undefined, 2);
              $('#schema-output').val(pretty_data);
            },
            error: function (msg, url, line) {
              alert('msg = ' + msg + ', url = ' + url + ', line = ' + line);
            }
          });
        $.ajax(
          {
            type: "POST",
            url: "http://localhost:8080/pipeline/data2html",
            data: payload,
            contentType: "application/json; charset=utf-8",
            dataType: "text",
            success: function (data) {
              $('#html-output').val(data);
            },
            error: function (msg, url, line) {
              alert('msg = ' + msg + ', url = ' + url + ', line = ' + line);
            }
          });
      });
    });
</script>
</head>

<body ng-app="schemaorg-pipeline-playground">
  <form>
    <!-- Header -->
    <div class="header row">
      <div class="col s12 m4 l4 logo">Schema.org Pipeline Playground</div>
      <div class="col s12 m8 l8 command">
        <a id="examples-dropdown" class="dropdown-button btn-flat btn-word white-text" href="#!"
          data-activates="dropdown-content" data-constrainwidth="false">Try Examples</a>
        <ul id="dropdown-content" class="dropdown-content">
          <li><a id="example1" class="dropdown-item black-text" href="#!">
            Annotate DrugBank RDF data (Language: CAML)</a></li>
          <li><a id="example2" class="dropdown-item black-text" href="#!">
            Annotate ClinicalTrials.gov XML document (Language: CAML)</a></li>
          <li><a id="example3" class="dropdown-item black-text" href="#!">
            Annotate DrugBank RDF data (Language: RML)</a></li>
          <li><a id="example4" class="dropdown-item black-text" href="#!">
            Annotate ClinicalTrials.gov XML document (Language: RML)</a></li>
        </ul>
        <button id="reset" class="btn-flat btn-icon waves-effect waves-light green-text" type="submit">
          <i class="material-icons">refresh</i>
        </button>
        <button id="run" class="btn-flat btn-icon waves-effect waves-light green white-text" type="submit">
          <i class="material-icons">send</i>
        </button>
      </div>
    </div>

    <!-- Main section -->
    <div class="main row">
      <div id="left" class="split split-horizontal">
        <div>
          <div class="col s12 m7 l7 panel-title">Mapping</div>
          <div class="col s12 m5 l5 panel-title">
            <select id="language-type" class="browser-default" style="height:25px;">
              <option value="">Select language</option>
              <option value="caml">CAML</option>
              <option value="rml">RML</option>
            </select>
          </div>
        </div>
        <textarea id="mapping-input" class="input-area"></textarea>
      </div>
      <div id="center" class="split split-horizontal">
        <div>
          <div class="col s12 m7 l7 panel-title">Data Source</div>
          <div class="col s12 m5 l5 panel-title">
            <select id="datasource-type" class="browser-default" style="height:25px;">
              <option value="">Select source type</option>
              <option value="sparql-endpoint">SPARQL-Endpoint</option>
              <option value="xml">XML</option>
            </select>
          </div>
        </div>
        <textarea id="datasource-input" class="input-area"></textarea>
      </div>
      <div id="right" class="split split-horizontal">
        <div id="translation-panel" class="panel split split-horizontal">
          <div class="panel-title">Mapping Translation</div>
          <textarea id="translation-output" class="output-area" disabled></textarea>
        </div>
        <div id="schema-panel" class="panel split split-horizontal">
          <div class="panel-title">Schema.org Annotation</div>
          <textarea id="schema-output" class="output-area" disabled></textarea>
        </div>
        <div id="html-panel" class="panel split split-horizontal">
          <div class="col s12 m10 l10 panel-title">HTML Source</div>
          <div class="col s12 m2 l2 panel-title">
            <a href="#!" id="render" class="right" title="Open a preview window" onclick="openPreview()">
              <i class="material-icons black-text" style="font-size:1.5rem;">open_in_new</i>
            </a>
          </div>
          <textarea id="html-output" class="output-area" disabled></textarea>
        </div>
        <div class="fixed-action-btn horizontal">
          <a class="btn-floating btn-large red">
            <i class="large material-icons">visibility</i>
          </a>
          <ul>
            <li><a class="btn-floating black" title="Show mapping translation" onclick="showTranslation()">
              <i class="material-icons">language</i></a></li>
            <li><a class="btn-floating black" title="Show schema.org annotation" onclick="showSchema()">
              <i class="material-icons">format_quote</i></a></li>
            <li><a class="btn-floating black" title="Show HTML source" onclick=showHtml()>
              <i class="material-icons">settings_ethernet</i></a></li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="footer row">
      Schema.org Pipeline Playground is developed as part of the <a href="https://metadatacenter.org/">CEDAR</a> supplement project (cc) 2017
    </br/>
    </div>
  </form>
</body>
<script type="text/javascript">
  var splitPanels = Split(['#left', '#center', '#right'], {
    direction: 'horizontal',
    sizes: [33.3, 33.3, 33.3],
    gutterSize: 8,
    cursor: 'col-resize'
  })
</script>
<script type="text/javascript">
  function showTranslation() {
    $('#translation-panel').show();
    $('#schema-panel').hide();
    $('#html-panel').hide();
  }
  function showSchema() {
    $('#translation-panel').hide();
    $('#schema-panel').show();
    $('#html-panel').hide();
  }
  function showHtml() {
    $('#translation-panel').hide();
    $('#schema-panel').hide();
    $('#html-panel').show();
  }
  function openPreview() {
    var html = $("#html-output").val();
    var htmlWindow = window.open("", "htmlOutputWindow", "width=1200,height=1000");
    htmlWindow.document.write(html);
  }
</script>
<script type="text/javascript">
  /* Input Strings for Example 1 */
  $('#example1').on("click", function() {
    var mapping = $.get('resources/example1.map.txt');
    var datasource = $.get('resources/example1.data.txt');
    $.when(mapping, datasource).done(function(mapping_data, datasource_data) {
      $('#language-type').val("caml");
      $('#mapping-input').val(mapping_data[0].trim());
      $('#datasource-type').val("sparql-endpoint");
      $('#datasource-input').val(datasource_data[0].trim());
    });
  });
  /* Input Strings for Example 2 */
  $('#example2').on("click", function() {
    var mapping = $.get('resources/example2.map.txt');
    var datasource = $.get('resources/example2.data.txt');
    $.when(mapping, datasource).done(function(mapping_data, datasource_data) {
      $('#language-type').val("caml");
      $('#mapping-input').val(mapping_data[0].trim());
      $('#datasource-type').val("xml");
      $('#datasource-input').val(datasource_data[0].trim());
    });
  });
  /* Input Strings for Example 3 */
  $('#example3').on("click", function() {
    var mapping = $.get('resources/example3.map.txt');
    var datasource = $.get('resources/example3.data.txt');
    $.when(mapping, datasource).done(function(mapping_data, datasource_data) {
      $('#language-type').val("rml");
      $('#mapping-input').val(mapping_data[0].trim());
      $('#datasource-type').val("sparql-endpoint");
      $('#datasource-input').val(datasource_data[0].trim());
    });
  });
  /* Input Strings for Example 4 */
  $('#example4').on("click", function() {
    var mapping = $.get('resources/example4.map.txt');
    var datasource = $.get('resources/example4.data.txt');
    $.when(mapping, datasource).done(function(mapping_data, datasource_data) {
      $('#language-type').val("rml");
      $('#mapping-input').val(mapping_data[0].trim());
      $('#datasource-type').val("xml");
      $('#datasource-input').val(datasource_data[0].trim());
    });
  });
</script>
</html>
